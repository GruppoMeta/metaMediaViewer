!function(){"use strict";function e(){var e={restrict:"E",templateUrl:"metaMediaViewer.html",scope:{medias:"=",options:"="},controller:i,controllerAs:"metaMediaViewer",bindToController:!0,replace:!0};return e}function i(e,i,a){var t=this,n=function(){a.find(".body img").on("load",e.setInitZoom),t.setMedia(1)},d=(new Date).getTime();t.modalMode=t.options.modal,t.contentHeight=!t.modalMode&&t.options.height,t.videogular={},t.videogular.onUpdateTime=function(e,i){t.videogular.currentTime=1e3*e,t.videogular.totalTime=1e3*i},t.videogular.config={sources:[]},t.close=function(){a.remove();var e=t.options.fnClosePrm;t.options.fnClose.apply(this,e)},t.currentMedia=1,t.totalMedias=t.medias.length,t.media=null,t.prev=!1,t.next=!1,t.setMedia=function(n,o){t.currentMedia=n?n:o?t.currentMedia+o:1,t.media=t.medias[t.currentMedia-1];var r=function(e,i,a){var t=["mp3","mp4","mkv","flv","vob","ogv","wmv","mpv","m2v","mpg","mpeg","ogg","mov","avi","wav","3gp","m4a","m4b","m4p","oga","mogg","raw","wma","wv","webm"];if(e.mimeType)return e.mimeType;var n=t.indexOf(a.split(".").pop());if(-1!==n)return i.toLowerCase()+"/"+a.split(".").pop();var d="AUDIO"===i?"mp3":"mp4";return i.toLowerCase()+"/"+d};if("PDF"===t.media.type)t.media.PdfUrl=i.trustAsResourceUrl(t.media.url);else if("VIDEO"===t.media.type||"AUDIO"===t.media.type){t.videogular.config.sources=[];var s=r(t.media,t.media.type,t.media.url),m={src:i.trustAsResourceUrl(t.media.url),type:s};t.videogular.config.sources.push(m)}else t.media.url=-1===t.media.url.indexOf("?timestamp="+d)?t.media.url+"?timestamp="+d:t.media.url,a.find(".body img").off().on("load",e.setInitZoom);t.prev=t.currentMedia>1,t.next=t.currentMedia<t.medias.length},t.setZoom=null,e.setInitZoom=function(e){var i=null,n=null,d=a.find(".body").width(),o=a.find(".body").height(),r=a.find(".body img").width(),s=a.find(".body img").height();r>d&&(i=d/r),s>o&&(n=o/s),i&&n?t.setZoom=n>=i?i:n:t.setZoom=i||n||1,a.find(".body img").css("zoom",t.setZoom),a.find(".body img").off("load")},t.zoomIn=function(){t.setZoom+=.2,a.find(".body img").css("zoom",t.setZoom)},t.zoomOut=function(){t.setZoom-=.2,a.find(".body img").css("zoom",t.setZoom)},e.$watch("metaMediaViewer.currentMedia",function(e,i){e&&e!==i&&t.setMedia(e)}),t.panelActive=!1,t.toggleEle=function(e){return!e},t.checkSupportedMedia=function(e){var i=["IMAGE","VIDEO","AUDIO","PDF"],a=-1!==i.indexOf(e);return a},n()}i.$inject=["$scope","$sce","$element"],angular.module("metaMediaViewerMdl",["com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","com.2fdevs.videogular.plugins.overlayplay","com.2fdevs.videogular.plugins.poster","ui.bootstrap","pdfjsViewer","720kb.tooltips"]).directive("metaMediaViewer",e)}(),angular.module("metaMediaViewerMdl").run(["$templateCache",function(e){e.put("metaMediaViewer.html",'<div class="contentMetaMediaViewer">\n    <div class="metaMediaViewer modal-preview animate-modal-preview {{metaMediaViewer.options.customClass}} {{metaMediaViewer.options.theme}} {{metaMediaViewer.modalMode ? \'modal-mode\' : \'\'}} {{metaMediaViewer.totalMedias>1 ? \'with-pagination\' : \'\'}}" style="height:{{metaMediaViewer.contentHeight}}">\n        <div class="box-numNav" ng-if="metaMediaViewer.totalMedias>1">\n            <uib-pagination total-items="metaMediaViewer.totalMedias" ng-model="metaMediaViewer.currentMedia" class="pagination-sm" boundary-links="true" first-text="Inizio" rotate="true" force-ellipses="true" last-text="Fine" items-per-page="1" max-size="10" direction-links="false" ></uib-pagination>\n        </div>\n        <div class="header">\n            <div class="box-btnHeader box-btnHeader-left">\n                <a class="btn-grid btnHeader" ng-class="{\'active\':metaMediaViewer.panelActive}" ng-click="metaMediaViewer.panelActive=metaMediaViewer.toggleEle(metaMediaViewer.panelActive)">\n                    <span class="fa fa-th-large"></span>\n                </a>\n                <a class="btn-download btnHeader" ng-href="{{metaMediaViewer.media.url}}" target="_blank">\n                    <span class="fa fa-download"></span>\n                </a>\n                <a class="btn-zoom btnHeader" ng-if="metaMediaViewer.media.type===\'IMAGE\'" ng-click="metaMediaViewer.zoomOut()">\n                    <span class="fa fa-search-minus"></span>\n                </a>\n                <a class="btn-zoom btnHeader" ng-if="metaMediaViewer.media.type===\'IMAGE\'" ng-click="metaMediaViewer.zoomIn()">\n                    <span class="fa fa-search-plus"></span>\n                </a>\n            </div>\n            <div class="title" ng-class="{\'margin-large\':metaMediaViewer.media.type===\'IMAGE\'}">{{metaMediaViewer.media.title}}</div>\n            <div class="btn-close" ng-if="metaMediaViewer.options.btnClose" ng-click="metaMediaViewer.close()">\n                <span class="fa fa-times"></span>\n            </div>\n        </div>\n        <div class="panel-left" ng-class="{\'with-pagination\':metaMediaViewer.totalMedias>1}">\n            <div class="box-mediaThumb" ng-class="{\'active\':metaMediaViewer.currentMedia===$index+1}" ng-repeat="media in metaMediaViewer.medias" ng-click="metaMediaViewer.setMedia($index+1)">\n                <div class="img-middle-responsive">\n                    <div class="responsive-container" >\n                        <div class="dummy"></div>\n                        <div class="img-container">\n                            <div class="centerer"></div>\n                            <img ng-src="{{media.thumbnail}}"/>\n                        </div>\n                    </div>\n                </div>\n                <div class="box-mediaTitle" tooltips tooltip-template="{{media.title}}">\n                    {{media.title}}\n                </div>\n            </div>\n        </div>\n        <div class="body" ng-class="{\'panel-active\':metaMediaViewer.panelActive, \'with-pagination\':metaMediaViewer.totalMedias>1}">\n            <div class="box-btnNav box-btnNav-left" ng-if="metaMediaViewer.prev" ng-click="metaMediaViewer.setMedia(false,-1)">\n                <div class="btnNav btnNav-left">\n                    <i class="fa fa-arrow-left"></i>\n                </div>\n            </div>\n            <div class="box-btnNav box-btnNav-right" ng-if="metaMediaViewer.next" ng-click="metaMediaViewer.setMedia(false,1)">\n                <div class="btnNav btnNav-right">\n                    <i class="fa fa-arrow-right"></i>\n                </div>\n            </div>\n            <div class="box-none" ng-if="!metaMediaViewer.checkSupportedMedia(metaMediaViewer.media.type)">\n                <h3>Tipo di media non supportato</h3>\n            </div>\n            <div class="box-img" ng-show="metaMediaViewer.media.type===\'IMAGE\'" >\n                <img ng-src="{{metaMediaViewer.media.url}}" ng-init="metaMediaViewer.setInitZoom()"/>\n            </div>\n            <div class="box-pdf" ng-if="metaMediaViewer.media.type===\'PDF\'">\n                <!--<iframe width="100%" height="100%" ng-src="{{metaMediaViewer.media.PdfUrl}}" frameborder="0"></iframe>-->\n                <pdfjs-viewer src="{{ metaMediaViewer.media.PdfUrl }}" download="{{metaMediaViewer.media.download}}" print="{{metaMediaViewer.media.print}}" open="{{metaMediaViewer.media.open}}">\n                </pdfjs-viewer>\n            </div>\n            <div class="box-multimedia" ng-if="metaMediaViewer.media.type===\'VIDEO\' || metaMediaViewer.media.type===\'AUDIO\'">\n                <videogular vg-update-time="metaMediaViewer.videogular.onUpdateTime($currentTime, $duration)" vg-theme="metaMediaViewer.videogular.config.theme" vg-responsive="true">\n                    <vg-media vg-src="metaMediaViewer.videogular.config.sources">\n                    </vg-media>\n\n                    <vg-controls>\n                        <vg-play-pause-button></vg-play-pause-button>\n                        <vg-time-display>{{ metaMediaViewer.videogular.currentTime | date:\'mm:ss\' }}</vg-time-display>\n                        <vg-scrub-bar>\n                            <vg-scrub-bar-current-time></vg-scrub-bar-current-time>\n                        </vg-scrub-bar>\n                        <vg-time-display>{{ metaMediaViewer.videogular.totalTime | date:\'mm:ss\' }}</vg-time-display>\n                        <vg-volume>\n                            <vg-mute-button></vg-mute-button>\n                            <vg-volume-bar></vg-volume-bar>\n                        </vg-volume>\n                        <vg-fullscreen-button></vg-fullscreen-button>\n                    </vg-controls>\n\n                    <vg-overlay-play></vg-overlay-play>\n                    <vg-poster vg-url=\'metaMediaViewer.media.thumbnail\'></vg-poster>\n                </videogular>\n            </div>\n        </div>\n    </div>\n</div>')}]);